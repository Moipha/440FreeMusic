"use strict";(self["webpackChunkvue"]=self["webpackChunkvue"]||[]).push([[576],{7576:function(t,s,i){i.r(s),i.d(s,{default:function(){return h}});var e=function(){var t=this,s=t._self._c;return s("div",{staticClass:"container"},[s("el-dialog",{ref:"dialog",attrs:{visible:t.showDialog,"show-close":!1,"modal-append-to-body":!1,"append-to-body":!1,"close-on-click-modal":!1},on:{"update:visible":function(s){t.showDialog=s}}},[s("div",{staticStyle:{color:"var(--listText)","padding-top":"15px"}},[s("div",{staticStyle:{"text-align":"center","font-size":"15px","font-weight":"bold"}},[t._v("编辑歌单信息")]),s("i",{staticClass:"el-icon-close close",on:{click:function(s){t.showDialog=!1}}})]),s("hr",{staticStyle:{border:"var(--hr) 1px solid","margin-top":"15px"}}),s("div",{staticClass:"avatarContainer"},[s("span",{staticStyle:{"margin-bottom":"10px"}},[t._v("封面")]),s("el-avatar",{staticStyle:{"margin-bottom":"10px"},attrs:{shape:"square",size:"large",src:t.src}}),s("el-upload",{ref:"avatar",attrs:{action:t.protocol+"://"+t.serverIp+"/avatar/saveAvatar",limit:1,"show-file-list":!1,"on-change":t.handleUploadAvatar,"auto-upload":!1,"on-success":t.handleAvatarUpload}},[s("span",{staticClass:"dialogBtn"},[t._v("更改封面")])]),s("span",{staticStyle:{"margin-top":"20px"}},[s("span",{staticStyle:{color:"tomato","font-size":"16px",position:"relative",top:"3px",right:"2px"}},[t._v("*")]),t._v(" 歌单名 ")]),s("el-input",{staticStyle:{"margin-top":"10px"},attrs:{"show-word-limit":"",maxlength:"20"},model:{value:t.list.title,callback:function(s){t.$set(t.list,"title",s)},expression:"list.title"}}),s("span",{staticStyle:{"margin-top":"20px","margin-bottom":"10px"}},[t._v("歌单描述")]),s("el-input",{attrs:{type:"textarea",rows:4,"show-word-limit":"",maxlength:"200"},model:{value:t.list.description,callback:function(s){t.$set(t.list,"description",s)},expression:"list.description"}})],1),s("hr",{staticStyle:{border:"var(--hr) 1px solid","margin-top":"15px"}}),s("span",{staticClass:"listBtn saveBtn",staticStyle:{"background-color":"var(--listBtn)",margin:"10px 20px 15px 10px"},on:{click:t.save}},[t._v("保存")]),s("span",{staticClass:"listBtn cancelBtn",staticStyle:{"background-color":"var(--listInput)",margin:"10px 0 15px"},on:{click:function(s){t.showDialog=!1}}},[t._v("取消")])]),s("div",{staticClass:"background"},[s("div",{staticClass:"avatar",style:`background-image: url(${t.src})`})]),s("div",{staticClass:"top"},[s("el-avatar",{staticClass:"left",attrs:{shape:"square",size:200,src:t.src}}),s("div",{staticClass:"right"},[s("div",{staticStyle:{"font-size":"30px","font-weight":"normal","margin-top":"40px","margin-bottom":"20px"}},[t._v(" "+t._s(t.list.title)+" "),t.isMine?s("el-tooltip",{attrs:{content:"编辑",placement:"top"}},[s("span",{staticClass:"el-icon-edit edit",on:{click:t.edit}})]):t._e()],1),s("div",{staticStyle:{"font-size":"15px"}},[t._v(t._s(t.author.username)+" · 创建于 "+t._s(t.list.createTime))]),s("div",{staticStyle:{"margin-top":"15px"}},[s("el-button",{staticClass:"btn",staticStyle:{width:"130px",height:"36px","border-radius":"18px 0 0 18px","font-size":"15px","line-height":"15px"},on:{click:t.playAll}},[s("i",{staticClass:"el-icon-video-play",staticStyle:{"margin-right":"5px",padding:"0"}}),t._v(" 播放全部 ")]),s("el-button",{staticClass:"btn",staticStyle:{width:"45px",height:"36px","border-radius":"0 18px 18px 0"},on:{click:t.addAll}},[s("i",{staticClass:"el-icon-plus",staticStyle:{"font-size":"15px"}})])],1)])],1),s("div",{staticClass:"bottom"},[s("table",[t._m(0),s("tr",{staticStyle:{height:"20px"}}),t._l(t.musics,(function(i){return s("tr",{staticClass:"items",attrs:{id:i.id===t.currentPlayId?"light":""},on:{contextmenu:function(s){return s.preventDefault(),t.openMenu(s,i)},dblclick:function(s){return t.dbClick(i)}}},[s("td",{staticStyle:{"padding-top":"5px"}},[s("el-avatar",{attrs:{src:i.avatar,shape:"square"}})],1),s("td",[t._v(t._s(i.name))]),s("td",[t._v(t._s(i.author))]),s("td",[t._v(t._s(i.album))]),s("td",[t._v(t._s(i.time))]),s("td",[s("span",{staticClass:"el-icon-more",staticStyle:{cursor:"pointer","font-size":"20px"},on:{click:function(s){return s.stopPropagation(),t.openMenu(s,i)}}})])])}))],2),0===t.musics.length?s("div",[t._m(1),s("div",{staticStyle:{"text-align":"center","margin-top":"20px","font-size":"20px"}},[t._v("暂 无 歌 曲")]),s("div",{staticStyle:{"font-size":"10px","text-align":"center","margin-top":"100px"}},[t._v("通过 搜索歌曲 -> 右键点击歌曲 -> 添加到歌单 即可往歌单中添加歌曲")])]):t._e()])],1)},a=[function(){var t=this,s=t._self._c;return s("tr",{staticStyle:{color:"var(--listTh)","font-size":"14px"}},[s("th",{staticStyle:{width:"5%"},attrs:{align:"center"}}),s("th",{staticStyle:{width:"40%"},attrs:{align:"left"}},[t._v("音乐标题")]),s("th",{staticStyle:{width:"20%"},attrs:{align:"left"}},[t._v("歌手")]),s("th",{staticStyle:{width:"20%"},attrs:{align:"left"}},[t._v("专辑")]),s("th",{staticStyle:{width:"5%"},attrs:{align:"left"}},[t._v("时长")]),s("th",{staticStyle:{width:"5%"},attrs:{align:"left"}})])},function(){var t=this,s=t._self._c;return s("div",{staticStyle:{"text-align":"center","margin-top":"100px","font-size":"40px"}},[s("i",{staticClass:"el-icon-box"})])}],l=i(2618),r={name:"List",data(){return{listTitle:this.$route.query.listTitle,listAuthor:this.$route.query.listAuthor,list:{},author:{},musics:[],showDialog:!1,existMenu:!1,serverIp:l.I,protocol:l.T,currentPlayId:-1}},computed:{src(){return this.list.avatar?this.list.avatar:this.musics[0]?this.musics[0].avatar:i(2043)},isMine(){return!!localStorage.getItem("user")&&JSON.parse(localStorage.getItem("user")).id.toString()===this.listAuthor}},methods:{getListData(){this.request.post("/list/getData",{title:this.listTitle,userId:this.listAuthor}).then((t=>{"200"===t.code?(this.list=t.data,this.getAuthorData(),this.getMusics()):this.$notify({type:"error",title:"获取歌单信息失败",message:t.msg})})).catch((t=>{this.$notify({type:"error",message:t,title:"获取歌单信息失败"})}))},getAuthorData(){this.request.post("/list/getAuthor/"+this.list.authorId).then((t=>{"200"===t.code?this.author=t.data:this.$notify({type:"error",message:t.msg,title:"获取创建者信息失败"})})).catch((t=>{this.$notify({type:"error",message:t,title:"获取创建者信息失败"})}))},getMusics(){this.request.post("/list/getMusics/"+this.list.id).then((t=>{"200"===t.code?this.musics=t.data.reverse():this.$notify({type:"error",title:"获取歌曲失败",message:t.msg})})).catch((t=>{this.$notify({type:"error",title:"获取歌曲失败",message:t})}))},edit(){this.showDialog=!0},save(){null===this.list.avatar&&this.updateList(),this.list.avatar.length>100?this.$refs.avatar.submit():this.updateList()},openMenu(t,s){t.x>1200?t.y>500?this.$bus.$emit("showMenu",t.x-230,t.y-200,!0,s,this.list,this.musics,"list"):this.$bus.$emit("showMenu",t.x-230,t.y,!0,s,this.list,this.musics,"list"):t.y>500?this.$bus.$emit("showMenu",t.x,t.y-230,!0,s,this.list,this.musics,"list"):this.$bus.$emit("showMenu",t.x,t.y,!0,s,this.list,this.musics,"list"),this.existMenu=!0},handleUploadAvatar(t){const s=new FileReader;s.readAsDataURL(t.raw),s.onload=()=>{this.list.avatar=s.result}},handleAvatarUpload(t){"200"!==t.code?this.$notify({title:"封面上传失败",message:t.msg,type:"error"}):(this.$notify({title:"封面上传成功",type:"success"}),this.list.avatar=t.data.url,this.updateList())},updateList(){this.request.post("/list/updateList",this.list).then((t=>{if("200"===t.code){this.$notify({type:"success",title:"更新成功",message:"歌单信息更新成功"}),this.$router.push("/list?listTitle="+this.list.title+"&listAuthor="+this.author.id);let t=JSON.parse(localStorage.getItem("user")),s=t.lists.findIndex((t=>t.id===this.list.id));t.lists.splice(s,1,this.list),localStorage.setItem("user",JSON.stringify(t)),this.$bus.$emit("changeLists",t.lists),this.showDialog=!1}else this.$notify({type:"error",title:"更新失败",message:t.msg})})).catch((t=>{this.$notify({type:"error",title:"更新失败",message:t})}))},getCurrentMusic(){this.currentPlayId=JSON.parse(localStorage.getItem("currentMusic"))?JSON.parse(localStorage.getItem("currentMusic")).id:""},dbClick(t){this.$bus.$emit("play",t,this.musics)},playAll(){this.dbClick(this.musics[0])},addAll(){let t=JSON.parse(localStorage.getItem("playList"));t=t.concat(this.musics),localStorage.setItem("playList",JSON.stringify(t)),this.$bus.$emit("getPlayList"),this.$notify({type:"success",title:"添加成功",message:"已将歌单中的内容添加至播放列表"})}},mounted(){this.getListData(),this.$bus.$on("changeList",(()=>{this.listTitle=this.$route.query.listTitle,this.listAuthor=this.$route.query.listAuthor,this.getListData()})),this.getCurrentMusic(),this.$bus.$on("getCurrentPlayMusic",(()=>{this.getCurrentMusic()}))},beforeDestroy(){this.$bus.$off("changeList"),this.$bus.$off("getCurrentPlayMusic")}},o=r,n=i(1001),c=(0,n.Z)(o,e,a,!1,null,"73d13a47",null),h=c.exports},2043:function(t,s,i){t.exports=i.p+"img/DefaultAvatar.e88d641e.png"}}]);
//# sourceMappingURL=576.07f80a34.js.map