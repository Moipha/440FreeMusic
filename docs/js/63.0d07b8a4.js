"use strict";(self["webpackChunkvue"]=self["webpackChunkvue"]||[]).push([[63],{4063:function(t,e,a){a.r(e),a.d(e,{default:function(){return p}});var i=function(){var t=this,e=t._self._c;return e("div",[e("el-card",{staticStyle:{"background-color":"var(--mineCardBg)",border:"none","border-radius":"10px",width:"80%",margin:"10px auto"}},[e("div",{staticStyle:{display:"inline-block",margin:"10px","vertical-align":"top"}},[e("el-avatar",{staticStyle:{width:"80px",height:"80px"}},[t._v(t._s(t.initials))])],1),e("span",{staticStyle:{color:"var(--mineText)","line-height":"100px","margin-left":"20px"}},[t._v(t._s(t.username.toUpperCase()))]),e("div",{staticStyle:{color:"var(--mineText)",display:"inline-block",float:"right",height:"100px","line-height":"80px","font-weight":"bold"}},[e("div",{staticClass:"inlineContainer"},[e("div",{staticClass:"flexContainer",on:{click:function(e){t.activeName="music"}}},[e("span",{staticStyle:{height:"25px"}},[t._v(t._s(t.tableData.length))]),e("span",[t._v("上传")])])]),e("div",{staticClass:"inlineContainer"},[e("div",{staticClass:"flexContainer",on:{click:function(e){return t.$router.push("/likes")}}},[e("span",{staticStyle:{height:"25px"}},[t._v(t._s(t.starCount))]),e("span",[t._v("收藏")])])]),e("div",{staticClass:"inlineContainer"},[e("div",{staticClass:"flexContainer"},[e("span",{staticStyle:{height:"25px"}},[t._v("0")]),e("span",[t._v("动态")])])])])]),e("el-tabs",{staticStyle:{width:"80%",margin:"20px auto",color:"var(--mineText)"},model:{value:t.activeName,callback:function(e){t.activeName=e},expression:"activeName"}},[e("el-tab-pane",{attrs:{label:"基本信息",name:"data"}},[e("el-form",{staticStyle:{"font-weight":"bold","margin-top":"20px"},attrs:{"label-position":"left","label-width":"80px",model:t.user}},[e("el-form-item",{attrs:{label:"用户名"}},[t._v(" "+t._s(t.user.username)+" ")]),e("el-form-item",{attrs:{label:"邮箱"}},[t._v(" "+t._s(t.user.email)+" ")]),e("el-form-item",{attrs:{label:"昵称"}},[t.nowChanging?t._e():e("span",[t._v(t._s(t.user.nickname?t.user.nickname:"暂无"))]),t.nowChanging?e("el-input",{ref:"myInput",staticClass:"input",on:{blur:t.cancelEdit},model:{value:t.nickname,callback:function(e){t.nickname=e},expression:"nickname"}}):t._e(),e("el-button",{staticClass:"mineBtn",attrs:{icon:t.currentIcon},on:{click:t.editNickname}})],1),e("el-form-item",{attrs:{label:"注册日期"}},[t._v(" "+t._s(t.user.createTime)+" ")])],1)],1),e("el-tab-pane",{attrs:{label:"账号设置",name:"setting"}},[e("el-form",{staticStyle:{"font-weight":"bold","margin-top":"20px"}},[e("el-form-item",{attrs:{label:"退出账号"}},[e("span",{staticClass:"lightText"},[t._v("退出当前账号并返回至登录界面。")]),e("el-button",{staticClass:"mineBtn",staticStyle:{float:"right"},on:{click:t.logout}},[t._v("退出账号")])],1),e("el-form-item",{attrs:{label:"登录密码"}},[e("span",{staticClass:"lightText"},[t._v("已设置。密码至少六位字符，支持数字、字母和除空格以外的特殊字符。")]),e("el-button",{staticClass:"mineBtn",staticStyle:{float:"right"},on:{click:t.changePassword}},[t._v("修改密码")])],1)],1)],1),e("el-tab-pane",{attrs:{label:"上传管理",name:"music"}},[e("el-button-group",[e("el-tooltip",{attrs:{content:"上传"}},[e("el-button",{staticClass:"btnInGroup btnGroup",attrs:{icon:"el-icon-plus"},on:{click:function(e){t.showDialog=!0}}})],1),e("el-tooltip",{attrs:{content:"批量操作"}},[e("el-button",{staticClass:"btnInGroup btnGroup",attrs:{icon:"el-icon-s-grid"},on:{click:t.mulEdit}})],1),t.showSelection?[e("el-tooltip",{attrs:{content:"批量启用"}},[e("el-button",{staticClass:"btnInGroup btnGroup",attrs:{icon:"el-icon-open"},on:{click:t.mulEnable}})],1),e("el-tooltip",{attrs:{content:"批量禁用"}},[e("el-button",{staticClass:"btnInGroup btnGroup",attrs:{icon:"el-icon-turn-off"},on:{click:t.mulDisable}})],1),e("el-tooltip",{attrs:{content:"批量删除"}},[e("el-button",{staticClass:"btnInGroup btnGroup",attrs:{icon:"el-icon-delete"},on:{click:t.mulDelete}})],1)]:t._e()],2),e("el-dialog",{ref:"dialog",attrs:{visible:t.showDialog,"show-close":!1,limit:1,"modal-append-to-body":!1,"append-to-body":!1},on:{"update:visible":function(e){t.showDialog=e}}},[e("div",{directives:[{name:"loading",rawName:"v-loading",value:t.loading,expression:"loading"}],staticStyle:{height:"100%!important"}},[e("el-upload",{ref:"uploader",staticClass:"upload-demo",attrs:{limit:1,drag:"",action:t.protocol+"://"+t.serverIp+"/music/getData","auto-upload":!0,"on-success":t.handleGetDataSuccess,"before-upload":t.beforeGetData,"show-file-list":!1,disabled:!t.showDragger}},[t.showDragger?[e("i",{staticClass:"el-icon-upload"}),e("div",{staticClass:"el-upload__text"},[t._v("将音频拖到此处，或"),e("em",[t._v("浏览本地音乐")])])]:[e("h1",{staticStyle:{"margin-top":"40px"}},[e("i",{staticClass:"el-icon-headset"}),t._v(" 音频文件已读取")]),e("h2",[t._v(t._s(t.fileName))])]],2),e("div",{staticStyle:{display:"flex","flex-direction":"row","margin-top":"40px"}},[e("div",{staticStyle:{display:"flex","flex-direction":"column",width:"40%"}},[e("span",{staticStyle:{"margin-left":"15px",color:"var(--mineText)"}},[t._v("点击上传封面：")]),e("el-upload",{ref:"avatar",staticClass:"avatar-uploader",staticStyle:{"margin-top":"10px"},attrs:{limit:1,"show-file-list":!1,"on-change":t.handleUploadAvatar,action:t.protocol+"://"+t.serverIp+"/avatar/saveAvatar","auto-upload":!1,"list-type":"picture",disabled:""!==t.uploadAvatar,"on-success":t.handleAvatarUpload}},[t.uploadAvatar?e("img",{staticClass:"avatar",attrs:{src:t.uploadAvatar,alt:""}}):e("i",{staticClass:"el-icon-plus avatar-uploader-icon"})])],1),e("el-form",{staticStyle:{width:"64%",display:"flex","flex-direction":"column"},attrs:{"label-position":"left","label-width":"120px"}},[e("el-form-item",{staticStyle:{"margin-bottom":"25px"},attrs:{label:"音乐标题："}},[e("el-input",{staticClass:"input",model:{value:t.newMusic.name,callback:function(e){t.$set(t.newMusic,"name",e)},expression:"newMusic.name"}})],1),e("el-form-item",{staticStyle:{"margin-bottom":"25px"},attrs:{label:"音乐作者："}},[e("el-input",{staticClass:"input",model:{value:t.newMusic.author,callback:function(e){t.$set(t.newMusic,"author",e)},expression:"newMusic.author"}})],1),e("el-form-item",{staticStyle:{"margin-bottom":"25px"},attrs:{label:"所属专辑："}},[e("el-input",{staticClass:"input",model:{value:t.newMusic.album,callback:function(e){t.$set(t.newMusic,"album",e)},expression:"newMusic.album"}})],1),e("el-form-item",{staticStyle:{"margin-bottom":"25px"},attrs:{label:"文件大小(KB)："}},[e("el-input",{staticClass:"input",attrs:{disabled:""},model:{value:t.newMusic.size,callback:function(e){t.$set(t.newMusic,"size",e)},expression:"newMusic.size"}})],1)],1)],1),e("div",{staticStyle:{width:"30%",margin:"30px auto"}},[e("el-button",{staticClass:"btnGroup btnInGroup",staticStyle:{float:"left",width:"80px",height:"40px"},on:{click:t.upload}},[t._v(" 上传 ")]),e("el-button",{staticClass:"btnGroup btnInGroup",staticStyle:{float:"right",width:"80px",height:"40px"},on:{click:t.cancelUpload}},[t._v(" 取消 ")])],1)],1)]),e("el-table",{directives:[{name:"loading",rawName:"v-loading",value:t.loadingTable,expression:"loadingTable"}],ref:"singleTable",staticStyle:{width:"100%",margin:"auto","padding-right":"8px"},attrs:{data:t.tableData},on:{"selection-change":t.handleSelectionChange},nativeOn:{mouseenter:function(e){return t.showScrollbar.apply(null,arguments)},mouseleave:function(e){return t.hideScrollbar.apply(null,arguments)}}},[t.showSelection?e("el-table-column",{attrs:{type:"selection",width:"50"}}):t._e(),e("el-table-column",{attrs:{width:"70"},scopedSlots:t._u([{key:"default",fn:function(t){return[e("el-avatar",{staticStyle:{"background-color":"#00000000"},attrs:{shape:"square",size:"medium",src:t.row.avatar}})]}}])}),e("el-table-column",{attrs:{property:"name",label:"音乐标题"}}),e("el-table-column",{attrs:{property:"author",label:"歌手"}}),e("el-table-column",{attrs:{property:"album",label:"专辑"}}),e("el-table-column",{attrs:{property:"createTime",label:"上传时间"}}),e("el-table-column",{attrs:{property:"time",label:"时长",width:"60"}}),e("el-table-column",{attrs:{property:"enable",label:"启用",width:"60"},scopedSlots:t._u([{key:"default",fn:function(a){return[e("el-switch",{on:{change:function(e){return t.changeEnable(a.row)}},model:{value:a.row.enable,callback:function(e){t.$set(a.row,"enable",e)},expression:"scope.row.enable"}})]}}])}),e("el-table-column",{attrs:{width:"20"}})],1)],1)],1)],1)},s=[],l=a(2618),n=a(4161),o={name:"Mine",data(){return{username:localStorage.getItem("user")?JSON.parse(localStorage.getItem("user")).username:"",nickname:localStorage.getItem("user")?JSON.parse(localStorage.getItem("user")).nickname:"",activeName:"data",user:localStorage.getItem("user")?JSON.parse(localStorage.getItem("user")):{},nowChanging:!1,tableData:[],showSelection:!1,multipleSelection:[],showDialog:!1,newMusic:{},loading:!1,serverIp:l.I,protocol:l.T,showDragger:!0,uploadAvatar:"",fileName:"",needSaveDB:!0,loadingTable:!0,starCount:0}},mounted(){this.getUploadList()},computed:{initials(){if(!this.username)return"";const t=this.username.charAt(0);return t.match(/[a-zA-Z]/)?t.toUpperCase():t},currentIcon(){return this.nowChanging?"el-icon-finished":"el-icon-edit"}},methods:{editNickname(){this.nowChanging=!this.nowChanging,this.nowChanging?this.$nextTick((()=>{this.$refs.myInput.focus()})):(this.user.nickname=this.nickname,this.request.post("/user/edit",this.user).then((t=>{"200"!==t.code?(this.$notify({title:"更新失败",message:t.msg,type:"error"}),this.user.nickname="",this.nowChanging=!0):(this.$notify({title:"成功",message:"个人信息更新成功",type:"success"}),localStorage.setItem("user",JSON.stringify(this.user)))})).catch((t=>{this.user.nickname="",this.nowChanging=!0,this.$notify({title:"更新失败",message:t,type:"error"})})))},cancelEdit(){setTimeout((()=>{this.nowChanging=!1,this.nickname=this.user.nickname}),200)},logout(){localStorage.removeItem("user"),this.$bus.$emit("logout"),this.$notify({title:"成功",message:"账号已登出",type:"success"}),this.$router.push("/login"),this.$bus.$emit("changeLists",[])},changePassword(){},handleSelectionChange(t){this.multipleSelection=t},changeEnable(t){},mulEnable(){this.multipleSelection.forEach((t=>{t.enable=!0}))},mulDisable(){this.multipleSelection.forEach((t=>{t.enable=!1}))},mulDelete(){this.multipleSelection.forEach((t=>{t.isDelete=!0}))},mulEdit(){this.showSelection=!this.showSelection},handleGetDataSuccess(t){this.newMusic=t.data,this.showDragger=!1,this.loading=!1},beforeGetData(t){this.fileName=t.name;const e=t.name.split(".").pop().toLowerCase(),a="mp3"===e||"flac"===e,i=t.size/1024/1024<50;if(a){if(i)return this.loading=!0,!0;this.$notify.error("上传音乐文件大小不能超过 50MB!")}else this.$notify.error("上传音乐只能是 MP3/FLAC 格式!");return!1},cancelUpload(){this.showDialog=!1,this.newMusic={},this.showDragger=!0,this.$refs.uploader.clearFiles(),this.uploadAvatar="",this.$refs.avatar.clearFiles(),this.fileName="",this.loading=!1},handleUploadAvatar(t){const e=new FileReader;e.readAsDataURL(t.raw),e.onload=()=>{this.uploadAvatar=e.result}},upload(){if(this.loading=!0,!this.$refs.uploader.uploadFiles.length)return this.$notify({title:"上传失败",message:"未选择音频",type:"error"}),void(this.loading=!1);let t=this.$refs.uploader.uploadFiles[0].raw,e=new FormData;e.append("file",t),n.Z.post(`${l.T}://${l.I}/music/saveMusic`,e,{headers:{"Content-Type":"multipart/form-data"}}).then((t=>{"200"!==t.data.code?(this.$notify({title:"音频上传失败",message:t.data.msg,type:"error"}),this.loading=!1):(this.$notify({title:"音频上传成功",type:"success"}),this.newMusic.url=t.data.data.url,this.newMusic.md5=t.data.data.md5,this.needSaveDB=t.data.data.enable,this.needSaveDB||(this.newMusic.id=t.data.data.id),this.uploadAvatar?this.$refs.avatar.submit():(this.newMusic.avatar=a(2043),this.saveMusic()))})).catch((t=>{this.$notify({title:"音频上传失败",message:t,type:"error"}),this.loading=!1}))},handleAvatarUpload(t){"200"!==t.code?(this.$notify({title:"封面上传失败",message:t.msg,type:"error"}),this.loading=!1):(this.$notify({title:"封面上传成功",type:"success"}),this.newMusic.avatar=t.data.url,this.saveMusic())},saveMusic(){this.newMusic.uploader=JSON.parse(localStorage.getItem("user")).id,""===this.newMusic.album&&(this.newMusic.album="未知专辑"),this.request.post("/music/saveDB",this.newMusic).then((t=>{"200"!==t.code?(this.$notify({title:"音乐信息保存失败",message:t.msg,type:"error"}),this.loading=!1):(this.needSaveDB?this.$notify({title:"音乐信息已存入数据库",type:"success"}):this.$notify({title:"音乐信息已更新",type:"info"}),this.getUploadList(),this.cancelUpload())}))},getUploadList(){this.loadingTable=!0,this.request.get("/user/getUploadList/"+JSON.parse(localStorage.getItem("user")).id).then((t=>{"200"!==t.code?this.$notify({title:"获取数据失败",message:t.msg,type:"error"}):this.tableData=t.data})),this.loadingTable=!1,this.request.get("/user/getStarCount/"+this.user.id.toString()).then((t=>{"200"!==t.code?this.$notify({title:"获取数据失败",message:t.msg,type:"error"}):this.starCount=t.data})).catch((t=>{this.$notify({title:"获取数据失败",message:t,type:"error"})}))},showScrollbar(){document.documentElement.style.setProperty("--test2","visible")},hideScrollbar(){document.documentElement.style.setProperty("--test2","hidden")}}},r=o,c=a(1001),u=(0,c.Z)(r,i,s,!1,null,"4f4eef07",null),p=u.exports},2043:function(t,e,a){t.exports=a.p+"img/DefaultAvatar.e88d641e.png"}}]);
//# sourceMappingURL=63.0d07b8a4.js.map